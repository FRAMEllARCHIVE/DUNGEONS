<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeons</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-map {
            position: absolute;
            width: 2000px;
            height: 2000px;
            background-image: url('map.png');
            background-size: cover;
        }

        .SSW1 { background-position: -200px -0px; }
        .SSW2 { background-position: -200px -100px; }
        .SSW3 { background-position: -200px -200px; }
        .SW1 { background-position: -300px -0px; }
        .SW2 { background-position: -300px -100px; }
        .SW3 { background-position: -300px -200px; }
        .SWW1 { background-position: -400px -0px; }
        .SWW2 { background-position: -400px -100px; }
        .SWW3 { background-position: -400px -200px; }
        .W1 { background-position: -500px -0px; }
        .W2 { background-position: -500px -100px; }
        .W3 { background-position: -500px -200px; }
        .NWW1 { background-position: -600px -0px; }
        .NWW2 { background-position: -600px -100px; }
        .NWW3 { background-position: -600px -200px; }
        .NW1 { background-position: -700px -0px; }
        .NW2 { background-position: -700px -100px; }
        .NW3 { background-position: -700px -200px; }
        .NNW1 { background-position: -800px -0px; }
        .NNW2 { background-position: -800px -100px; }
        .NNW3 { background-position: -800px -200px; }
        .N1 { background-position: -900px -0px; }
        .N2 { background-position: -900px -100px; }
        .N3 { background-position: -900px -200px; }
        .NNE1 { background-position: -1000px -0px; }
        .NNE2 { background-position: -1000px -100px; }
        .NNE3 { background-position: -1000px -200px; }
        .NE1 { background-position: -1100px -0px; }
        .NE2 { background-position: -1100px -100px; }
        .NE3 { background-position: -1100px -200px; }
        .NEE1 { background-position: -1200px -0px; }
        .NEE2 { background-position: -1200px -100px; }
        .NEE3 { background-position: -1200px -200px; }
        .E1 { background-position: -1300px -0px; }
        .E2 { background-position: -1300px -100px; }
        .E3 { background-position: -1300px -200px; }
        .SEE1 { background-position: -1400px -0px; }
        .SEE2 { background-position: -1400px -100px; }
        .SEE3 { background-position: -1400px -200px; }
        .SE1 { background-position: -1500px -0px; }
        .SE2 { background-position: -1500px -100px; }
        .SE3 { background-position: -1500px -200px; }
        .SSE1 { background-position: -1600px -0px; }
        .SSE2 { background-position: -1600px -100px; }
        .SSE3 { background-position: -1600px -200px; }
        .S1 { background-position: -100px -0px; }
        .S2 { background-position: -100px -100px; }
        .S3 { background-position: -100px -200px; }
        .idle1 { background-position: -0px -0px; }
        .idle2 { background-position: -0px -100px; }
        .idle3 { background-position: -0px -200px; }

        #player {
            position: absolute;
            width: 100px;
            height: 100px;
            background-image: url('spritesheet.png');
            background-repeat: no-repeat;
        }

    </style>
</head>
<body>
    <div id="game-map">
        <div id="player" class="idle1"></div>

<svg id="obstacle-svg" width="2000" height="2000">
    <path id="obstacle-path" d="M100 100 H 200 L 200 200 L 100 200 Z" fill="red"/>
</svg>

    </div>


    <script>

        let player = {
            positionX: 900,
            positionY: 800,
            velocityX: 0,
            velocityY: 0,
            friction: 0.95,
            maxVelocity: 6,
            acceleration: 0.65,
            spriteIndex: 1,
            idleFrameTime: 0,
            movingKeys: {}
        };

        const playerElement = document.getElementById('player');
        const gameMap = document.getElementById('game-map');
        const obstacleElement = document.getElementById('obstacle');





//COLLISION DETECTION

function checkCollision() {
}



//GAMELOOP

function updateGame() {
    inputController.updateVelocity();

player.velocityX *= player.friction;
player.velocityY *= player.friction;

if (Math.abs(player.velocityX) < 0.2) player.velocityX = 0;
if (Math.abs(player.velocityY) < 0.2) player.velocityY = 0;


    const magnitude = Math.sqrt(player.velocityX ** 2 + player.velocityY ** 2);
    if (magnitude > player.maxVelocity) {
        player.velocityX = (player.velocityX / magnitude) * player.maxVelocity;
        player.velocityY = (player.velocityY / magnitude) * player.maxVelocity;
    }

    player.positionX += player.velocityX;
    player.positionY += player.velocityY;

    player.positionX = Math.max(0, Math.min(player.positionX, 2000 - playerElement.offsetWidth));
    player.positionY = Math.max(0, Math.min(player.positionY, 2000 - playerElement.offsetHeight));

checkCollision();

    playerElement.style.left = `${player.positionX}px`;
    playerElement.style.top = `${player.positionY}px`;

    gameMap.style.left = `-${player.positionX - window.innerWidth / 2}px`;
    gameMap.style.top = `-${player.positionY - window.innerHeight / 2}px`;

    spriteController.updateSprite();

    requestAnimationFrame(updateGame);
}



//INPUT CONTROLLER

const inputController = {
    updateVelocity: () => {
        // Update velocity based on key presses
        if (player.movingKeys['ArrowUp']) {
            player.velocityY -= player.acceleration;
        }
        if (player.movingKeys['ArrowDown']) {
            player.velocityY += player.acceleration;
        }
        if (player.movingKeys['ArrowLeft']) {
            player.velocityX -= player.acceleration;
        }
        if (player.movingKeys['ArrowRight']) {
            player.velocityX += player.acceleration;
        }
    }
};



//SPRITE CONTROLLER

const spriteController = {
    updateSprite: () => {
        const { velocityX, velocityY } = player;
        const direction = getDirection(velocityX, velocityY);

        player.idleFrameTime += 1;

        if (direction !== 'idle') {
            if (player.idleFrameTime > 10) { 
                if (player.spriteIndex === 1) {
                    playerElement.className = `${direction}1`;
                    player.spriteIndex = 2;
                } else if (player.spriteIndex === 2) {
                    playerElement.className = `${direction}2`;
                    player.spriteIndex = 3;
                } else {
                    playerElement.className = `${direction}3`;
                    player.spriteIndex = 1;
                }
                player.idleFrameTime = 0;
            }
        } else {
            if (player.idleFrameTime > 10) {
                if (player.spriteIndex === 1) {
                    playerElement.className = 'idle1';
                    player.spriteIndex = 2;
                } else if (player.spriteIndex === 2) {
                    playerElement.className = 'idle2';
                    player.spriteIndex = 3;
                } else {
                    playerElement.className = 'idle3';
                    player.spriteIndex = 1;
                }
                player.idleFrameTime = 0;
            }
        }
    }
};


function getDirection(velocityX, velocityY) {
    if (velocityX === 0 && velocityY === 0) return 'idle';

    const angle = Math.atan2(-velocityY, velocityX) * (180 / Math.PI);
    const normalizedAngle = (angle + 360) % 360;

    const directions = [
        'E', 'NEE', 'NE', 'NNE', 'N', 'NNW', 'NW', 'NWW', 
        'W', 'SWW', 'SW', 'SSW', 'S', 'SSE', 'SE', 'SEE'
    ];

    const index = Math.floor((normalizedAngle + 11.25) / 22.5) % 16;

    return directions[index];
}



//EVENT LISTENERS


document.addEventListener('keydown', (event) => {
    if (event.key === 'ArrowUp' || event.key === 'ArrowDown' || event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
        player.movingKeys[event.key] = true;
    }
});

document.addEventListener('keyup', (event) => {
    if (event.key === 'ArrowUp' || event.key === 'ArrowDown' || event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
        player.movingKeys[event.key] = false;
    }
});

        updateGame();
    </script>
</body>
</html>
